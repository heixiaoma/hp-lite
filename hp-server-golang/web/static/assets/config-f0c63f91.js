import{s as c}from"./http-3b3dacbe.js";import{r as x,j as Y,g as M,h as Z,o as u,c as i,b as n,w as o,a as g,e as k,f as s,k as h,i as d,F as q,t as p,l as ee}from"./index-30332199.js";import{u as te}from"./userInfo-b8e9852a.js";import{q as ae}from"./domain-4ce13ad1.js";function ne(f){return c({url:"/client/config/getConfigList",method:"get",params:f})}function le(f){return c({url:"/client/config/removeConfig",method:"get",params:f})}function oe(f){return c({url:"/client/config/refConfig",method:"get",params:f})}function se(f){return c({url:"/client/config/changeStatus",method:"get",params:f})}function ue(f){return c({url:"/client/config/addConfig",method:"post",data:f})}function ie(f){return c({url:"/client/config/getDeviceKey",method:"get",params:f})}const de={key:0},re={key:1},pe={key:2},ve={key:0},ye={key:0},fe={key:1},me={class:"text-detail"},ge={key:0},ke={key:0},Te={class:"text-tips"},_e={key:1},Ce={class:"text-tips"},be={key:1},xe={key:0},ce={class:"text-tips"},Ie={key:2},Pe={key:0},Ue={class:"text-tips"},De={key:1},Ke={class:"text-tips"},we={key:2},Ve={class:"text-tips"},qe={key:3},Ne={class:"text-tips"},Be={key:4},Qe={__name:"config",setup(f){const N=x([]),S=Y(),_=M({total:0,current:1,pageSize:10}),E=l=>{_.current=l.current,_.pageSize=l.pageSize,_.total=l.total,b()},B=x(),I=x(!1),T=x(!1),a=M({id:void 0,deviceKey:"",remarks:"",port:void 0,domain:void 0,localIp:"",localPort:void 0,connectType:"",proxyVersion:"NONE",webType:"http",status:"0",tunType:"TCP"}),K=x(),P=x(),O=l=>{T.value=!0,se({configId:l.id}).then(e=>{T.value=!1,e.code===200&&(!l.status||l.status==0?l.status=1:l.status=0)})},Q=()=>{ae({}).then(l=>{const e=l.data.data;console.log(e),e.forEach(v=>{N.value.push({value:v.domain,label:v.domain})})})},L=()=>{ie().then(l=>{let e=[];for(let v of l.data)e.push({label:v.desc,value:v.key,userDesc:v.userDesc,username:v.username});P.value=e})},F=l=>{try{return P.value.filter(e=>e.value===l)[0].label}catch{return"设备获取错误"}},U=l=>{try{return P.value.filter(e=>e.value===l)[0]}catch{return""}},b=()=>{K.value=[],T.value=!0,ne(_).then(l=>{T.value=!1,K.value=l.data.records,_.current=l.data.current,_.total=l.data.total}).catch(l=>{T.value=!1})};Z(()=>{L(),Q(),b()});const $=l=>{le({configId:l.id}).then(e=>{e.data&&b()})},z=l=>{a.id=l.id,a.deviceKey=l.deviceKey,a.remarks=l.remarks,a.port=l.port,a.domain=l.domain,a.localIp=l.localIp,a.localPort=l.localPort,a.connectType=l.connectType,a.proxyVersion=l.proxyVersion,l.webType||(l.webType="http"),l.tunType||(l.tunType="QUIC"),a.tunType=l.tunType,a.webType=l.webType,a.status=l.status+"",I.value=!0},H=l=>{T.value=!0,oe({configId:l.id}).then(e=>{T.value=!1,e.data&&b()})},R=()=>{a.id=void 0,a.deviceKey="",a.remarks="",a.port=void 0,a.domain=void 0,a.localIp="",a.localPort=void 0,a.connectType="",a.proxyVersion="NONE",a.webType="http",a.tunType="",a.status="0",I.value=!0},j=()=>{B.value.validate().then(l=>{console.log("添加配置表单",a),a.status=parseInt(a.status),ue({packageId:S.query.packageId,...a}).then(e=>{b(),I.value=!1})})},A=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"隧道模式",dataIndex:"tunType",key:"tunType"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"外网端口",dataIndex:"port",key:"port"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"配置有效",dataIndex:"status",key:"status"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(l,e)=>{const v=k("a-button"),W=k("a-switch"),X=k("a-table"),C=k("a-select"),m=k("a-form-item"),D=k("a-input"),w=k("a-divider"),y=k("a-select-option"),G=k("a-form"),J=k("a-modal");return u(),i("div",null,[n(v,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:R},{default:o(()=>e[12]||(e[12]=[s("添加穿透")])),_:1}),n(v,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:b},{default:o(()=>e[13]||(e[13]=[s("刷新列表")])),_:1}),n(X,{loading:T.value,columns:A,rowKey:"id","data-source":K.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:_,onChange:E,scroll:{x:10}},{bodyCell:o(({column:t,record:r})=>[t.key==="status"?(u(),h(W,{key:0,checked:!r.status||r.status==0,onClick:V=>O(r)},null,8,["checked","onClick"])):d("",!0),t.key==="tunType"?(u(),i(q,{key:1},[r.tunType&&r.tunType==="TCP"?(u(),i("div",de," TCP多路复用 ")):r.tunType&&r.tunType==="QUIC"?(u(),i("div",re," QUIC多路复用 ")):(u(),i("div",pe," QUIC多路复用 "))],64)):d("",!0),t.key==="deviceKey"?(u(),i(q,{key:2},[g("div",null," 设备状态："+p(F(r.deviceKey)),1),ee(te).getUserInfo().role==="ADMIN"?(u(),i("div",ve,[U(r.deviceKey).username?(u(),i("div",ye," 归属用户： "+p(U(r.deviceKey).username),1)):d("",!0),U(r.deviceKey).userDesc?(u(),i("div",fe," 归属用户备注："+p(U(r.deviceKey).userDesc),1)):d("",!0)])):d("",!0)],64)):d("",!0),t.key==="action"?(u(),i(q,{key:3},[n(v,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>$(r)},{default:o(()=>e[14]||(e[14]=[s("删除 ")])),_:2},1032,["onClick"]),n(v,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>z(r)},{default:o(()=>e[15]||(e[15]=[s("编辑 ")])),_:2},1032,["onClick"]),n(v,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>H(r)},{default:o(()=>e[16]||(e[16]=[s("重连配置 ")])),_:2},1032,["onClick"])],64)):d("",!0)]),expandedRowRender:o(({record:t})=>[g("div",me,[g("div",null,"备注："+p(t.remarks),1),t.connectType==="TCP"?(u(),i("div",ge,[t.port?(u(),i("div",ke,[e[17]||(e[17]=s("外网TCP地址: ")),g("span",Te,p(t.serverIp)+":"+p(t.port),1)])):d("",!0),t.domain?(u(),i("div",_e,[e[18]||(e[18]=s("外网HTTP地址: ")),g("span",Ce,"http(s)://"+p(t.domain),1)])):d("",!0)])):d("",!0),t.connectType==="UDP"?(u(),i("div",be,[t.port?(u(),i("div",xe,[e[19]||(e[19]=s("外网UDP地址: ")),g("span",ce,p(t.serverIp)+":"+p(t.port),1)])):d("",!0)])):d("",!0),t.connectType==="TCP_UDP"?(u(),i("div",Ie,[t.port?(u(),i("div",Pe,[e[20]||(e[20]=s("外网UDP地址: ")),g("span",Ue,p(t.serverIp)+":"+p(t.port),1)])):d("",!0),t.port?(u(),i("div",De,[e[21]||(e[21]=s("外网TCP地址: ")),g("span",Ke,p(t.serverIp)+":"+p(t.port),1)])):d("",!0),t.domain?(u(),i("div",we,[e[22]||(e[22]=s("外网HTTP地址: ")),g("span",Ve,"http(s)://"+p(t.domain),1)])):d("",!0)])):d("",!0),t.statusMsg?(u(),i("div",qe,[e[23]||(e[23]=s(" 最近一条穿透服务日志：")),g("span",Ne,p(t.statusMsg),1)])):d("",!0),t.port?d("",!0):(u(),i("div",Be," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),g("div",null,[n(J,{okText:"确定",cancelText:"取消",visible:I.value,"onUpdate:visible":e[11]||(e[11]=t=>I.value=t),title:"添加内网穿透配置",onOk:j},{default:o(()=>[n(G,{model:a,layout:"vertical",ref_key:"formTable",ref:B},{default:o(()=>[n(m,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:o(()=>[n(C,{value:a.deviceKey,"onUpdate:value":e[0]||(e[0]=t=>a.deviceKey=t),options:P.value},null,8,["value","options"])]),_:1}),n(m,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:o(()=>[n(D,{value:a.remarks,"onUpdate:value":e[1]||(e[1]=t=>a.remarks=t),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),n(w,null,{default:o(()=>e[24]||(e[24]=[s("端口映射配置")])),_:1}),n(m,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:o(()=>[n(C,{value:a.connectType,"onUpdate:value":e[2]||(e[2]=t=>a.connectType=t)},{default:o(()=>[n(y,{value:"TCP"},{default:o(()=>e[25]||(e[25]=[s("TCP")])),_:1}),n(y,{value:"UDP"},{default:o(()=>e[26]||(e[26]=[s("UDP")])),_:1}),n(y,{value:"TCP_UDP"},{default:o(()=>e[27]||(e[27]=[s("TCP_UDP")])),_:1})]),_:1},8,["value"])]),_:1}),n(m,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:o(()=>[n(D,{value:a.port,"onUpdate:value":e[3]||(e[3]=t=>a.port=t),valueModifiers:{number:!0},type:"number",placeholder:"8084"},null,8,["value"])]),_:1}),n(m,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:o(()=>[n(D,{value:a.localIp,"onUpdate:value":e[4]||(e[4]=t=>a.localIp=t),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),n(m,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:o(()=>[n(D,{value:a.localPort,"onUpdate:value":e[5]||(e[5]=t=>a.localPort=t),valueModifiers:{number:!0},type:"number",placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),n(m,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:o(()=>[n(C,{value:a.proxyVersion,"onUpdate:value":e[6]||(e[6]=t=>a.proxyVersion=t)},{default:o(()=>[n(y,{value:"NONE"},{default:o(()=>e[28]||(e[28]=[s("不设置(小白用户请不要设置-用于获取真实IP)")])),_:1}),n(y,{value:"V1"},{default:o(()=>e[29]||(e[29]=[s("TCP#V1版本")])),_:1}),n(y,{value:"V2"},{default:o(()=>e[30]||(e[30]=[s("TCP#V2版本")])),_:1}),n(y,{value:"V3"},{default:o(()=>e[31]||(e[31]=[s("HTTP#X-Forwarded-For")])),_:1})]),_:1},8,["value"])]),_:1}),n(w,null,{default:o(()=>e[32]||(e[32]=[s("域名选项配置")])),_:1}),n(m,{label:"内网WEB类型",name:"webType",rules:[{required:!0,message:"内网环境下的web类型 http/https"}]},{default:o(()=>[n(C,{value:a.webType,"onUpdate:value":e[7]||(e[7]=t=>a.webType=t)},{default:o(()=>[n(y,{value:"http"},{default:o(()=>e[33]||(e[33]=[s("http")])),_:1}),n(y,{value:"https"},{default:o(()=>e[34]||(e[34]=[s("https")])),_:1})]),_:1},8,["value"])]),_:1}),n(m,{label:" 穿透域名  ",name:"domain"},{default:o(()=>[n(C,{value:a.domain,"onUpdate:value":e[8]||(e[8]=t=>a.domain=t),"show-search":"",placeholder:"选择一个域名",options:N.value},null,8,["value","options"])]),_:1}),n(w,null,{default:o(()=>e[35]||(e[35]=[s("其他选项配置")])),_:1}),n(m,{label:"配置有效",name:"status",rules:[{required:!0,message:"当前配置是否有效"}]},{default:o(()=>[n(C,{value:a.status,"onUpdate:value":e[9]||(e[9]=t=>a.status=t)},{default:o(()=>[n(y,{value:"0"},{default:o(()=>e[36]||(e[36]=[s("有效")])),_:1}),n(y,{value:"1"},{default:o(()=>e[37]||(e[37]=[s("无效")])),_:1})]),_:1},8,["value"])]),_:1}),n(m,{label:"隧道模式",name:"tunType",rules:[{required:!0,message:"选择隧道模式"}]},{default:o(()=>[n(C,{value:a.tunType,"onUpdate:value":e[10]||(e[10]=t=>a.tunType=t)},{default:o(()=>[n(y,{value:"TCP"},{default:o(()=>e[38]||(e[38]=[s("TCP多路复用模式")])),_:1}),n(y,{value:"QUIC"},{default:o(()=>e[39]||(e[39]=[s("QUIC多路复用模式")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{Qe as default};

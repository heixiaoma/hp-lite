import{s as b}from"./http-447fb395.js";import{r as h,v as J,h as B,i as Y,a as m,o as u,c as i,d as a,w as o,b as _,f as s,F as I,t as p,m as r,q as Z,j as ee}from"./index-3e957d92.js";import{u as te}from"./userInfo-b8e9852a.js";import{q as ae}from"./domain-4a80b0ce.js";function ne(y){return b({url:"/client/config/getConfigList",method:"get",params:y})}function le(y){return b({url:"/client/config/removeConfig",method:"get",params:y})}function oe(y){return b({url:"/client/config/refConfig",method:"get",params:y})}function se(y){return b({url:"/client/config/changeStatus",method:"get",params:y})}function ue(y){return b({url:"/client/config/addConfig",method:"post",data:y})}function ie(y){return b({url:"/client/config/getDeviceKey",method:"get",params:y})}const re={key:0},de={key:1},pe={key:2},ce={key:0},ve={key:0},ye={key:1},fe={class:"text-detail"},_e={key:0},me={key:0},ge={class:"text-tips"},ke={key:1},Te={class:"text-tips"},Ce={key:1},he={key:0},be={class:"text-tips"},xe={key:2},Ie={key:0},Pe={class:"text-tips"},Ue={key:1},De={class:"text-tips"},Ke={key:2},we={class:"text-tips"},Ve={key:3},qe={class:"text-tips"},Ne={key:4},Oe={__name:"config",setup(y){const q=h([]),M=J(),T=B({total:0,current:1,pageSize:10}),S=n=>{T.current=n.current,T.pageSize=n.pageSize,T.total=n.total,C()},N=h(),x=h(!1),g=h(!1),t=B({id:void 0,deviceKey:"",remarks:"",port:void 0,domain:void 0,localIp:"",localPort:void 0,connectType:"",proxyVersion:"NONE",webType:"http",status:"0",tunType:"TCP"}),K=h(),P=h(),E=n=>{g.value=!0,se({configId:n.id}).then(l=>{g.value=!1,l.code===200&&(!n.status||n.status==0?n.status=1:n.status=0)})},O=()=>{ae({}).then(n=>{const l=n.data.data;console.log(l),l.forEach(c=>{q.value.push({value:c.domain,label:c.domain})})})},Q=()=>{ie().then(n=>{let l=[];for(let c of n.data)l.push({label:c.desc,value:c.key,userDesc:c.userDesc,username:c.username});P.value=l})},L=n=>{try{return P.value.filter(l=>l.value===n)[0].label}catch{return"设备获取错误"}},U=n=>{try{return P.value.filter(l=>l.value===n)[0]}catch{return""}},C=()=>{O(),K.value=[],g.value=!0,ne(T).then(n=>{g.value=!1,K.value=n.data.records,T.total=n.data.total}).catch(n=>{g.value=!1})};Y(()=>{Q(),C()});const F=n=>{le({configId:n.id}).then(l=>{l.data&&C()})},$=n=>{t.id=n.id,t.deviceKey=n.deviceKey,t.remarks=n.remarks,t.port=n.port,t.domain=n.domain,t.localIp=n.localIp,t.localPort=n.localPort,t.connectType=n.connectType,t.proxyVersion=n.proxyVersion,n.webType||(n.webType="http"),n.tunType||(n.tunType="QUIC"),t.tunType=n.tunType,t.webType=n.webType,t.status=n.status+"",x.value=!0},z=n=>{g.value=!0,oe({configId:n.id}).then(l=>{g.value=!1,l.data&&C()})},H=()=>{t.id=void 0,t.deviceKey="",t.remarks="",t.port=void 0,t.domain=void 0,t.localIp="",t.localPort=void 0,t.connectType="",t.proxyVersion="NONE",t.webType="http",t.tunType="",t.status="0",x.value=!0},R=()=>{N.value.validate().then(n=>{console.log("添加配置表单",t),t.status=parseInt(t.status),ue({packageId:M.query.packageId,...t}).then(l=>{C(),x.value=!1})})},j=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"隧道模式",dataIndex:"tunType",key:"tunType"},{title:"内网服务",dataIndex:"local",key:"local"},{title:"外网服务",dataIndex:"server",key:"server"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"配置有效",dataIndex:"status",key:"status"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(n,l)=>{const c=m("a-button"),A=m("a-switch"),W=m("a-table"),k=m("a-select"),f=m("a-form-item"),D=m("a-input"),w=m("a-divider"),v=m("a-select-option"),X=m("a-form"),G=m("a-modal");return u(),i("div",null,[a(c,{type:"primary",style:{"margin-bottom":"10px"},onClick:H},{default:o(()=>[s("添加穿透")]),_:1}),a(c,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:C},{default:o(()=>[s("刷新列表")]),_:1}),a(W,{loading:g.value,columns:j,rowKey:"id","data-source":K.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:T,onChange:S,scroll:{x:"max-content"}},{bodyCell:o(({column:e,record:d})=>[e.key==="local"?(u(),i(I,{key:0},[s(p(d.localIp)+":"+p(d.localPort),1)],64)):r("",!0),e.key==="server"?(u(),i(I,{key:1},[s(p(d.serverIp)+":"+p(d.port),1)],64)):r("",!0),e.key==="status"?(u(),Z(A,{key:2,checked:!d.status||d.status==0,onClick:V=>E(d)},null,8,["checked","onClick"])):r("",!0),e.key==="tunType"?(u(),i(I,{key:3},[d.tunType&&d.tunType==="TCP"?(u(),i("div",re," TCP多路复用 ")):d.tunType&&d.tunType==="QUIC"?(u(),i("div",de," QUIC多路复用 ")):(u(),i("div",pe," QUIC多路复用 "))],64)):r("",!0),e.key==="deviceKey"?(u(),i(I,{key:4},[_("div",null," 设备状态："+p(L(d.deviceKey)),1),ee(te).getUserInfo().role==="ADMIN"?(u(),i("div",ce,[U(d.deviceKey).username?(u(),i("div",ve," 归属用户： "+p(U(d.deviceKey).username),1)):r("",!0),U(d.deviceKey).userDesc?(u(),i("div",ye," 归属用户备注："+p(U(d.deviceKey).userDesc),1)):r("",!0)])):r("",!0)],64)):r("",!0),e.key==="action"?(u(),i(I,{key:5},[a(c,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>F(d)},{default:o(()=>[s("删除 ")]),_:2},1032,["onClick"]),a(c,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>$(d)},{default:o(()=>[s("编辑 ")]),_:2},1032,["onClick"]),a(c,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>z(d)},{default:o(()=>[s("重连配置 ")]),_:2},1032,["onClick"])],64)):r("",!0)]),expandedRowRender:o(({record:e})=>[_("div",fe,[_("div",null,"备注："+p(e.remarks),1),e.connectType==="TCP"?(u(),i("div",_e,[e.port?(u(),i("div",me,[s("外网TCP地址: "),_("span",ge,p(e.serverIp)+":"+p(e.port),1)])):r("",!0),e.domain?(u(),i("div",ke,[s("外网HTTP地址: "),_("span",Te,"http(s)://"+p(e.domain),1)])):r("",!0)])):r("",!0),e.connectType==="UDP"?(u(),i("div",Ce,[e.port?(u(),i("div",he,[s("外网UDP地址: "),_("span",be,p(e.serverIp)+":"+p(e.port),1)])):r("",!0)])):r("",!0),e.connectType==="TCP_UDP"?(u(),i("div",xe,[e.port?(u(),i("div",Ie,[s("外网UDP地址: "),_("span",Pe,p(e.serverIp)+":"+p(e.port),1)])):r("",!0),e.port?(u(),i("div",Ue,[s("外网TCP地址: "),_("span",De,p(e.serverIp)+":"+p(e.port),1)])):r("",!0),e.domain?(u(),i("div",Ke,[s("外网HTTP地址: "),_("span",we,"http(s)://"+p(e.domain),1)])):r("",!0)])):r("",!0),e.statusMsg?(u(),i("div",Ve,[s(" 最近一条穿透服务日志："),_("span",qe,p(e.statusMsg),1)])):r("",!0),e.port?r("",!0):(u(),i("div",Ne," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),_("div",null,[a(G,{okText:"确定",cancelText:"取消",visible:x.value,"onUpdate:visible":l[11]||(l[11]=e=>x.value=e),title:"添加内网穿透配置",onOk:R},{default:o(()=>[a(X,{model:t,layout:"vertical",ref_key:"formTable",ref:N},{default:o(()=>[a(f,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:o(()=>[a(k,{value:t.deviceKey,"onUpdate:value":l[0]||(l[0]=e=>t.deviceKey=e),options:P.value},null,8,["value","options"])]),_:1}),a(f,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:o(()=>[a(D,{value:t.remarks,"onUpdate:value":l[1]||(l[1]=e=>t.remarks=e),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),a(w,null,{default:o(()=>[s("端口映射配置")]),_:1}),a(f,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:o(()=>[a(k,{value:t.connectType,"onUpdate:value":l[2]||(l[2]=e=>t.connectType=e)},{default:o(()=>[a(v,{value:"TCP"},{default:o(()=>[s("TCP")]),_:1}),a(v,{value:"UDP"},{default:o(()=>[s("UDP")]),_:1}),a(v,{value:"TCP_UDP"},{default:o(()=>[s("TCP_UDP")]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:o(()=>[a(D,{value:t.port,"onUpdate:value":l[3]||(l[3]=e=>t.port=e),valueModifiers:{number:!0},type:"number",placeholder:"8084"},null,8,["value"])]),_:1}),a(f,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:o(()=>[a(D,{value:t.localIp,"onUpdate:value":l[4]||(l[4]=e=>t.localIp=e),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),a(f,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:o(()=>[a(D,{value:t.localPort,"onUpdate:value":l[5]||(l[5]=e=>t.localPort=e),valueModifiers:{number:!0},type:"number",placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),a(f,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:o(()=>[a(k,{value:t.proxyVersion,"onUpdate:value":l[6]||(l[6]=e=>t.proxyVersion=e)},{default:o(()=>[a(v,{value:"NONE"},{default:o(()=>[s("不设置(小白用户请不要设置-用于获取真实IP)")]),_:1}),a(v,{value:"V1"},{default:o(()=>[s("TCP#V1版本")]),_:1}),a(v,{value:"V2"},{default:o(()=>[s("TCP#V2版本")]),_:1}),a(v,{value:"V3"},{default:o(()=>[s("HTTP#X-Forwarded-For")]),_:1})]),_:1},8,["value"])]),_:1}),a(w,null,{default:o(()=>[s("域名选项配置")]),_:1}),a(f,{label:"内网WEB类型",name:"webType",rules:[{required:!0,message:"内网环境下的web类型 http/https"}]},{default:o(()=>[a(k,{value:t.webType,"onUpdate:value":l[7]||(l[7]=e=>t.webType=e)},{default:o(()=>[a(v,{value:"http"},{default:o(()=>[s("http")]),_:1}),a(v,{value:"https"},{default:o(()=>[s("https")]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:" 穿透域名  ",name:"domain"},{default:o(()=>[a(k,{value:t.domain,"onUpdate:value":l[8]||(l[8]=e=>t.domain=e),"show-search":"",placeholder:"选择一个域名",options:q.value},null,8,["value","options"])]),_:1}),a(w,null,{default:o(()=>[s("其他选项配置")]),_:1}),a(f,{label:"配置有效",name:"status",rules:[{required:!0,message:"当前配置是否有效"}]},{default:o(()=>[a(k,{value:t.status,"onUpdate:value":l[9]||(l[9]=e=>t.status=e)},{default:o(()=>[a(v,{value:"0"},{default:o(()=>[s("有效")]),_:1}),a(v,{value:"1"},{default:o(()=>[s("无效")]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"隧道模式",name:"tunType",rules:[{required:!0,message:"选择隧道模式"}]},{default:o(()=>[a(k,{value:t.tunType,"onUpdate:value":l[10]||(l[10]=e=>t.tunType=e)},{default:o(()=>[a(v,{value:"TCP"},{default:o(()=>[s("TCP多路复用模式")]),_:1}),a(v,{value:"QUIC"},{default:o(()=>[s("QUIC多路复用模式")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{Oe as default};

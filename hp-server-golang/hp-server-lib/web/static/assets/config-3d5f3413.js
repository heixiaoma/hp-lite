import{s as T}from"./http-72129eb7.js";import{r as x,k as J,h as N,i as Q,a as m,o as r,c as u,d as o,w as l,b as p,f as i,F as R,t as c,l as W,j as d}from"./index-f9e88132.js";import{u as Z}from"./userInfo-b8e9852a.js";import{q as ee}from"./domain-24134c37.js";function te(f){return T({url:"/client/config/getConfigList",method:"get",params:f})}function ae(f){return T({url:"/client/config/removeConfig",method:"get",params:f})}function ne(f){return T({url:"/client/config/refConfig",method:"get",params:f})}function oe(f){return T({url:"/client/config/addConfig",method:"post",data:f})}function le(f){return T({url:"/client/config/getDeviceKey",method:"get",params:f})}const ie={key:0},se={key:0},re={key:1},ue={class:"text-detail"},de={key:0},ce={key:0},pe={class:"text-tips"},fe={key:1},ve={class:"text-tips"},me={key:1},ye={key:0},_e={class:"text-tips"},ge={key:2},ke={key:0},Ce={class:"text-tips"},xe={key:1},Ie={class:"text-tips"},Te={key:2},be={class:"text-tips"},he={key:3},Pe={class:"text-tips"},Ke={key:4},qe={__name:"config",setup(f){const D=x([]),w=J(),_=N({total:0,current:1,pageSize:10}),B=n=>{_.current=n.current,_.pageSize=n.pageSize,_.total=n.total,C()},V=x(),I=x(!1),k=x(!1),t=N({id:void 0,deviceKey:"",remarks:"",port:void 0,domain:void 0,localIp:"",localPort:void 0,connectType:"",proxyVersion:"",certificateKey:"",certificateContent:""}),U=x(),b=x(),A=()=>{ee({}).then(n=>{const a=n.data.data;console.log(a),a.forEach(s=>{D.value.push({value:s.domain,label:s.domain,certificateContent:s.certificateContent,certificateKey:s.certificateKey})})})},M=n=>{const a=D.value.filter(s=>s.value===n);console.log(a),a.length===1&&(t.certificateKey=a[0].certificateKey.trim(),t.certificateContent=a[0].certificateContent.trim())},S=()=>{le().then(n=>{let a=[];for(let s of n.data)a.push({label:s.desc,value:s.key,userDesc:s.userDesc,username:s.username});b.value=a})},F=n=>{try{return b.value.filter(a=>a.value===n)[0].label}catch{return"设备获取错误"}},h=n=>{try{return b.value.filter(a=>a.value===n)[0]}catch{return""}},C=()=>{U.value=[],k.value=!0,te(_).then(n=>{k.value=!1,U.value=n.data.records,_.current=n.data.current,_.total=n.data.total}).catch(n=>{k.value=!1})};Q(()=>{S(),A(),C()});const L=n=>{ae({configId:n.id}).then(a=>{a.data&&C()})},O=n=>{t.id=n.id,t.deviceKey=n.deviceKey,t.remarks=n.remarks,t.port=n.port,t.domain=n.domain,t.localIp=n.localIp,t.localPort=n.localPort,t.connectType=n.connectType,t.proxyVersion=n.proxyVersion,t.certificateKey=n.certificateKey,t.certificateContent=n.certificateContent,I.value=!0},z=n=>{k.value=!0,ne({configId:n.id}).then(a=>{k.value=!1,a.data&&C()})},G=()=>{t.id=void 0,t.deviceKey="",t.remarks="",t.port=void 0,t.domain=void 0,t.localIp="",t.localPort=void 0,t.connectType="",t.proxyVersion="",t.certificateKey="",t.certificateContent="",I.value=!0},H=()=>{V.value.validate().then(n=>{console.log("添加配置表单",t),oe({packageId:w.query.packageId,...t}).then(a=>{C(),I.value=!1})})},Y=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"外网端口",dataIndex:"port",key:"port"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(n,a)=>{const s=m("a-button"),$=m("a-table"),P=m("a-select"),v=m("a-form-item"),K=m("a-input"),g=m("a-select-option"),E=m("a-textarea"),j=m("a-form"),X=m("a-modal");return r(),u("div",null,[o(s,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:G},{default:l(()=>[i("添加穿透")]),_:1}),o(s,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:C},{default:l(()=>[i("刷新列表")]),_:1}),o($,{loading:k.value,columns:Y,rowKey:"id","data-source":U.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:_,onChange:B,scroll:{x:10}},{bodyCell:l(({column:e,record:y})=>[e.key==="deviceKey"?(r(),u(R,{key:0},[p("div",null," 设备状态："+c(F(y.deviceKey)),1),W(Z).getUserInfo().role==="ADMIN"?(r(),u("div",ie,[h(y.deviceKey).username?(r(),u("div",se," 归属用户： "+c(h(y.deviceKey).username),1)):d("",!0),h(y.deviceKey).userDesc?(r(),u("div",re," 归属用户备注："+c(h(y.deviceKey).userDesc),1)):d("",!0)])):d("",!0)],64)):d("",!0),e.key==="action"?(r(),u(R,{key:1},[o(s,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:q=>L(y)},{default:l(()=>[i("删除 ")]),_:2},1032,["onClick"]),o(s,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:q=>O(y)},{default:l(()=>[i("编辑 ")]),_:2},1032,["onClick"]),o(s,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:q=>z(y)},{default:l(()=>[i("重连配置 ")]),_:2},1032,["onClick"])],64)):d("",!0)]),expandedRowRender:l(({record:e})=>[p("div",ue,[p("div",null,"备注："+c(e.remarks),1),e.connectType==="TCP"?(r(),u("div",de,[e.port?(r(),u("div",ce,[i("外网TCP地址: "),p("span",pe,c(e.serverIp)+":"+c(e.port),1)])):d("",!0),e.domain?(r(),u("div",fe,[i("外网HTTP地址: "),p("span",ve,"http(s)://"+c(e.domain),1)])):d("",!0)])):d("",!0),e.connectType==="UDP"?(r(),u("div",me,[e.port?(r(),u("div",ye,[i("外网UDP地址: "),p("span",_e,c(e.serverIp)+":"+c(e.port),1)])):d("",!0)])):d("",!0),e.connectType==="TCP_UDP"?(r(),u("div",ge,[e.port?(r(),u("div",ke,[i("外网UDP地址: "),p("span",Ce,c(e.serverIp)+":"+c(e.port),1)])):d("",!0),e.port?(r(),u("div",xe,[i("外网TCP地址: "),p("span",Ie,c(e.serverIp)+":"+c(e.port),1)])):d("",!0),e.domain?(r(),u("div",Te,[i("外网HTTP地址: "),p("span",be,"http(s)://"+c(e.domain),1)])):d("",!0)])):d("",!0),e.statusMsg?(r(),u("div",he,[i(" 最近一条穿透服务日志："),p("span",Pe,c(e.statusMsg),1)])):d("",!0),e.port?d("",!0):(r(),u("div",Ke," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),p("div",null,[o(X,{okText:"确定",cancelText:"取消",visible:I.value,"onUpdate:visible":a[10]||(a[10]=e=>I.value=e),title:"添加内网穿透配置",onOk:H},{default:l(()=>[o(j,{model:t,ref_key:"formTable",ref:V},{default:l(()=>[o(v,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:l(()=>[o(P,{value:t.deviceKey,"onUpdate:value":a[0]||(a[0]=e=>t.deviceKey=e),options:b.value},null,8,["value","options"])]),_:1}),o(v,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:l(()=>[o(K,{value:t.remarks,"onUpdate:value":a[1]||(a[1]=e=>t.remarks=e),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),o(v,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:l(()=>[o(P,{value:t.connectType,"onUpdate:value":a[2]||(a[2]=e=>t.connectType=e)},{default:l(()=>[o(g,{value:"TCP"},{default:l(()=>[i("TCP")]),_:1}),o(g,{value:"UDP"},{default:l(()=>[i("UDP")]),_:1}),o(g,{value:"TCP_UDP"},{default:l(()=>[i("TCP_UDP")]),_:1})]),_:1},8,["value"])]),_:1}),o(v,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:l(()=>[o(K,{value:t.port,"onUpdate:value":a[3]||(a[3]=e=>t.port=e),valueModifiers:{number:!0},type:"number",placeholder:"8084"},null,8,["value"])]),_:1}),o(v,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:l(()=>[o(K,{value:t.localIp,"onUpdate:value":a[4]||(a[4]=e=>t.localIp=e),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),o(v,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:l(()=>[o(K,{value:t.localPort,"onUpdate:value":a[5]||(a[5]=e=>t.localPort=e),valueModifiers:{number:!0},type:"number",placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),o(v,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:l(()=>[o(P,{value:t.proxyVersion,"onUpdate:value":a[6]||(a[6]=e=>t.proxyVersion=e)},{default:l(()=>[o(g,{value:"NONE"},{default:l(()=>[i("不设置(小白用户请不要设置-用于获取真实IP)")]),_:1}),o(g,{value:"V1"},{default:l(()=>[i("TCP#V1版本")]),_:1}),o(g,{value:"V2"},{default:l(()=>[i("TCP#V2版本")]),_:1}),o(g,{value:"V3"},{default:l(()=>[i("HTTP#X-Forwarded-For")]),_:1})]),_:1},8,["value"])]),_:1}),o(v,{label:" 穿透域名  ",name:"domain"},{default:l(()=>[o(P,{value:t.domain,"onUpdate:value":a[7]||(a[7]=e=>t.domain=e),"show-search":"",placeholder:"选择一个域名",options:D.value,onChange:M},null,8,["value","options"])]),_:1}),o(v,{label:" 证书KEY  ",name:"certificateKey",rules:[{required:!1,message:"必须填写证书.key文件"}]},{default:l(()=>[o(E,{disabled:"disabled",rows:6,value:t.certificateKey,"onUpdate:value":a[8]||(a[8]=e=>t.certificateKey=e),placeholder:`-----BEGIN RSA PRIVATE KEY-----
***大概是这样的证书私钥***
-----END RSA PRIVATE KEY-----`},null,8,["value"])]),_:1},8,["rules"]),o(v,{label:" 证书内容  ",name:"certificateContent",rules:[{required:!1,message:"映射描述必填"}]},{default:l(()=>[o(E,{disabled:"disabled",rows:6,value:t.certificateContent,"onUpdate:value":a[9]||(a[9]=e=>t.certificateContent=e),placeholder:`-----BEGIN CERTIFICATE-----
***大概是这样的证书内容***
-----BEGIN CERTIFICATE-----`},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{qe as default};

import{s as T}from"./http-b969c686.js";import{r as b,k as Z,h as q,i as ee,a as m,o as i,c as r,d as l,w as o,b as _,f as s,l as te,j as d,F as B,t as c,m as ae}from"./index-e408c769.js";import{u as ne}from"./userInfo-b8e9852a.js";import{q as le}from"./domain-10ec9ed5.js";function oe(p){return T({url:"/client/config/getConfigList",method:"get",params:p})}function se(p){return T({url:"/client/config/removeConfig",method:"get",params:p})}function ie(p){return T({url:"/client/config/refConfig",method:"get",params:p})}function ue(p){return T({url:"/client/config/changeStatus",method:"get",params:p})}function re(p){return T({url:"/client/config/addConfig",method:"post",data:p})}function de(p){return T({url:"/client/config/getDeviceKey",method:"get",params:p})}const ce={key:0},pe={key:0},fe={key:1},ve={class:"text-detail"},ye={key:0},me={key:0},_e={class:"text-tips"},ge={key:1},ke={class:"text-tips"},Ce={key:1},he={key:0},be={class:"text-tips"},Te={key:2},xe={key:0},Ie={class:"text-tips"},Pe={key:1},Ke={class:"text-tips"},De={key:2},Ue={class:"text-tips"},we={key:3},Ee={class:"text-tips"},Ve={key:4},Se={__name:"config",setup(p){const D=b([]),R=Z(),k=q({total:0,current:1,pageSize:10}),S=n=>{k.current=n.current,k.pageSize=n.pageSize,k.total=n.total,C()},E=b(),x=b(!1),g=b(!1),e=q({id:void 0,deviceKey:"",remarks:"",port:void 0,domain:void 0,localIp:"",localPort:void 0,connectType:"",proxyVersion:"NONE",webType:"http",status:"0",certificateKey:"",certificateContent:""}),U=b(),I=b(),A=n=>{g.value=!0,ue({configId:n.id}).then(a=>{g.value=!1,a.code===200&&(!n.status||n.status==0?n.status=1:n.status=0)})},M=()=>{le({}).then(n=>{const a=n.data.data;console.log(a),a.forEach(u=>{D.value.push({value:u.domain,label:u.domain,certificateContent:u.certificateContent,certificateKey:u.certificateKey})})})},F=n=>{const a=D.value.filter(u=>u.value===n);console.log(a),a.length===1&&(e.certificateKey=a[0].certificateKey.trim(),e.certificateContent=a[0].certificateContent.trim())},O=()=>{de().then(n=>{let a=[];for(let u of n.data)a.push({label:u.desc,value:u.key,userDesc:u.userDesc,username:u.username});I.value=a})},L=n=>{try{return I.value.filter(a=>a.value===n)[0].label}catch{return"设备获取错误"}},P=n=>{try{return I.value.filter(a=>a.value===n)[0]}catch{return""}},C=()=>{U.value=[],g.value=!0,oe(k).then(n=>{g.value=!1,U.value=n.data.records,k.current=n.data.current,k.total=n.data.total}).catch(n=>{g.value=!1})};ee(()=>{O(),M(),C()});const $=n=>{se({configId:n.id}).then(a=>{a.data&&C()})},z=n=>{e.id=n.id,e.deviceKey=n.deviceKey,e.remarks=n.remarks,e.port=n.port,e.domain=n.domain,e.localIp=n.localIp,e.localPort=n.localPort,e.connectType=n.connectType,e.proxyVersion=n.proxyVersion,e.certificateKey=n.certificateKey,e.certificateContent=n.certificateContent,n.webType||(n.webType="http"),e.webType=n.webType,e.status=n.status+"",x.value=!0},G=n=>{g.value=!0,ie({configId:n.id}).then(a=>{g.value=!1,a.data&&C()})},H=()=>{e.id=void 0,e.deviceKey="",e.remarks="",e.port=void 0,e.domain=void 0,e.localIp="",e.localPort=void 0,e.connectType="",e.proxyVersion="NONE",e.certificateKey="",e.certificateContent="",e.webType="http",e.status="0",x.value=!0},Y=()=>{E.value.validate().then(n=>{console.log("添加配置表单",e),e.status=parseInt(e.status),re({packageId:R.query.packageId,...e}).then(a=>{C(),x.value=!1})})},j=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"外网端口",dataIndex:"port",key:"port"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"配置有效",dataIndex:"status",key:"status"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(n,a)=>{const u=m("a-button"),W=m("a-switch"),X=m("a-table"),h=m("a-select"),f=m("a-form-item"),K=m("a-input"),V=m("a-divider"),v=m("a-select-option"),N=m("a-textarea"),J=m("a-form"),Q=m("a-modal");return i(),r("div",null,[l(u,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:H},{default:o(()=>[s("添加穿透")]),_:1}),l(u,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:C},{default:o(()=>[s("刷新列表")]),_:1}),l(X,{loading:g.value,columns:j,rowKey:"id","data-source":U.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:k,onChange:S,scroll:{x:10}},{bodyCell:o(({column:t,record:y})=>[t.key==="status"?(i(),te(W,{key:0,checked:!y.status||y.status==0,onClick:w=>A(y)},null,8,["checked","onClick"])):d("",!0),t.key==="deviceKey"?(i(),r(B,{key:1},[_("div",null," 设备状态："+c(L(y.deviceKey)),1),ae(ne).getUserInfo().role==="ADMIN"?(i(),r("div",ce,[P(y.deviceKey).username?(i(),r("div",pe," 归属用户： "+c(P(y.deviceKey).username),1)):d("",!0),P(y.deviceKey).userDesc?(i(),r("div",fe," 归属用户备注："+c(P(y.deviceKey).userDesc),1)):d("",!0)])):d("",!0)],64)):d("",!0),t.key==="action"?(i(),r(B,{key:2},[l(u,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:w=>$(y)},{default:o(()=>[s("删除 ")]),_:2},1032,["onClick"]),l(u,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:w=>z(y)},{default:o(()=>[s("编辑 ")]),_:2},1032,["onClick"]),l(u,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:w=>G(y)},{default:o(()=>[s("重连配置 ")]),_:2},1032,["onClick"])],64)):d("",!0)]),expandedRowRender:o(({record:t})=>[_("div",ve,[_("div",null,"备注："+c(t.remarks),1),t.connectType==="TCP"?(i(),r("div",ye,[t.port?(i(),r("div",me,[s("外网TCP地址: "),_("span",_e,c(t.serverIp)+":"+c(t.port),1)])):d("",!0),t.domain?(i(),r("div",ge,[s("外网HTTP地址: "),_("span",ke,"http(s)://"+c(t.domain),1)])):d("",!0)])):d("",!0),t.connectType==="UDP"?(i(),r("div",Ce,[t.port?(i(),r("div",he,[s("外网UDP地址: "),_("span",be,c(t.serverIp)+":"+c(t.port),1)])):d("",!0)])):d("",!0),t.connectType==="TCP_UDP"?(i(),r("div",Te,[t.port?(i(),r("div",xe,[s("外网UDP地址: "),_("span",Ie,c(t.serverIp)+":"+c(t.port),1)])):d("",!0),t.port?(i(),r("div",Pe,[s("外网TCP地址: "),_("span",Ke,c(t.serverIp)+":"+c(t.port),1)])):d("",!0),t.domain?(i(),r("div",De,[s("外网HTTP地址: "),_("span",Ue,"http(s)://"+c(t.domain),1)])):d("",!0)])):d("",!0),t.statusMsg?(i(),r("div",we,[s(" 最近一条穿透服务日志："),_("span",Ee,c(t.statusMsg),1)])):d("",!0),t.port?d("",!0):(i(),r("div",Ve," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),_("div",null,[l(Q,{okText:"确定",cancelText:"取消",visible:x.value,"onUpdate:visible":a[12]||(a[12]=t=>x.value=t),title:"添加内网穿透配置",onOk:Y},{default:o(()=>[l(J,{model:e,layout:"vertical",ref_key:"formTable",ref:E},{default:o(()=>[l(f,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:o(()=>[l(h,{value:e.deviceKey,"onUpdate:value":a[0]||(a[0]=t=>e.deviceKey=t),options:I.value},null,8,["value","options"])]),_:1}),l(f,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:o(()=>[l(K,{value:e.remarks,"onUpdate:value":a[1]||(a[1]=t=>e.remarks=t),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),l(V,null,{default:o(()=>[s("端口映射配置")]),_:1}),l(f,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:o(()=>[l(h,{value:e.connectType,"onUpdate:value":a[2]||(a[2]=t=>e.connectType=t)},{default:o(()=>[l(v,{value:"TCP"},{default:o(()=>[s("TCP")]),_:1}),l(v,{value:"UDP"},{default:o(()=>[s("UDP")]),_:1}),l(v,{value:"TCP_UDP"},{default:o(()=>[s("TCP_UDP")]),_:1})]),_:1},8,["value"])]),_:1}),l(f,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:o(()=>[l(K,{value:e.port,"onUpdate:value":a[3]||(a[3]=t=>e.port=t),valueModifiers:{number:!0},type:"number",placeholder:"8084"},null,8,["value"])]),_:1}),l(f,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:o(()=>[l(K,{value:e.localIp,"onUpdate:value":a[4]||(a[4]=t=>e.localIp=t),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),l(f,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:o(()=>[l(K,{value:e.localPort,"onUpdate:value":a[5]||(a[5]=t=>e.localPort=t),valueModifiers:{number:!0},type:"number",placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),l(f,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:o(()=>[l(h,{value:e.proxyVersion,"onUpdate:value":a[6]||(a[6]=t=>e.proxyVersion=t)},{default:o(()=>[l(v,{value:"NONE"},{default:o(()=>[s("不设置(小白用户请不要设置-用于获取真实IP)")]),_:1}),l(v,{value:"V1"},{default:o(()=>[s("TCP#V1版本")]),_:1}),l(v,{value:"V2"},{default:o(()=>[s("TCP#V2版本")]),_:1}),l(v,{value:"V3"},{default:o(()=>[s("HTTP#X-Forwarded-For")]),_:1})]),_:1},8,["value"])]),_:1}),l(V,null,{default:o(()=>[s("域名选项配置")]),_:1}),l(f,{label:"内网WEB类型",name:"webType",rules:[{required:!0,message:"内网环境下的web类型 http/https"}]},{default:o(()=>[l(h,{value:e.webType,"onUpdate:value":a[7]||(a[7]=t=>e.webType=t)},{default:o(()=>[l(v,{value:"http"},{default:o(()=>[s("http")]),_:1}),l(v,{value:"https"},{default:o(()=>[s("https")]),_:1})]),_:1},8,["value"])]),_:1}),l(f,{label:" 穿透域名  ",name:"domain"},{default:o(()=>[l(h,{value:e.domain,"onUpdate:value":a[8]||(a[8]=t=>e.domain=t),"show-search":"",placeholder:"选择一个域名",options:D.value,onChange:F},null,8,["value","options"])]),_:1}),l(f,{label:" 证书KEY  ",name:"certificateKey",rules:[{required:!1,message:"必须填写证书.key文件"}]},{default:o(()=>[l(N,{disabled:"disabled",rows:6,value:e.certificateKey,"onUpdate:value":a[9]||(a[9]=t=>e.certificateKey=t),placeholder:`-----BEGIN RSA PRIVATE KEY-----
***大概是这样的证书私钥***
-----END RSA PRIVATE KEY-----`},null,8,["value"])]),_:1},8,["rules"]),l(f,{label:" 证书内容  ",name:"certificateContent",rules:[{required:!1,message:"映射描述必填"}]},{default:o(()=>[l(N,{disabled:"disabled",rows:6,value:e.certificateContent,"onUpdate:value":a[10]||(a[10]=t=>e.certificateContent=t),placeholder:`-----BEGIN CERTIFICATE-----
***大概是这样的证书内容***
-----BEGIN CERTIFICATE-----`},null,8,["value"])]),_:1}),l(f,{label:"配置有效",name:"status",rules:[{required:!0,message:"当前配置是否有效"}]},{default:o(()=>[l(h,{value:e.status,"onUpdate:value":a[11]||(a[11]=t=>e.status=t)},{default:o(()=>[l(v,{value:"0"},{default:o(()=>[s("有效")]),_:1}),l(v,{value:"1"},{default:o(()=>[s("无效")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{Se as default};

import{s as P}from"./http-4dcb8eff.js";import{k as $,u as j,h as N,r as T,i as X,a as m,o as s,c as r,d as n,w as l,b as c,f as i,F as q,t as d,l as J,j as u}from"./index-16371ab8.js";import{u as Q}from"./userInfo-b8e9852a.js";function W(p){return P({url:"/client/config/getConfigList",method:"get",params:p})}function Z(p){return P({url:"/client/config/removeConfig",method:"get",params:p})}function ee(p){return P({url:"/client/config/refConfig",method:"get",params:p})}function te(p){return P({url:"/client/config/addConfig",method:"post",data:p})}function ae(p){return P({url:"/client/config/getDeviceKey",method:"get",params:p})}const ne={key:0},oe={key:0},le={key:1},ie={class:"text-detail"},se={key:0},re={key:0},ue={class:"text-tips"},de={key:1},ce={class:"text-tips"},pe={key:1},fe={key:0},ve={class:"text-tips"},me={key:2},ye={key:0},_e={class:"text-tips"},ge={key:1},ke={class:"text-tips"},Ce={key:2},xe={class:"text-tips"},Ie={key:3},Te={class:"text-tips"},Pe={key:4},De={__name:"config",setup(p){const R=$();j();const y=N({total:0,current:1,pageSize:10}),B=o=>{y.current=o.current,y.pageSize=o.pageSize,y.total=o.total,C()},U=T(),x=T(!1),k=T(!1),t=N({id:void 0,deviceKey:"",remarks:"",port:void 0,domain:void 0,localIp:"",localPort:void 0,connectType:"",proxyVersion:"",certificateKey:"",certificateContent:""}),h=T(),b=T(),S=()=>{ae().then(o=>{let a=[];for(let f of o.data)a.push({label:f.desc,value:f.key,userDesc:f.userDesc,username:f.username});b.value=a})},w=o=>{try{return b.value.filter(a=>a.value===o)[0].label}catch{return"设备获取错误"}},K=o=>{try{return b.value.filter(a=>a.value===o)[0]}catch{return""}},C=()=>{h.value=[],k.value=!0,W(y).then(o=>{k.value=!1,h.value=o.data.records,y.current=o.data.current,y.pageSize=o.data.size,y.total=o.data.total}).catch(o=>{k.value=!1})};X(()=>{S(),C()});const A=o=>{Z({configId:o.id}).then(a=>{a.data&&C()})},M=o=>{t.id=o.id,t.deviceKey=o.deviceKey,t.remarks=o.remarks,t.port=o.port,t.domain=o.domain,t.localIp=o.localIp,t.localPort=o.localPort,t.connectType=o.connectType,t.proxyVersion=o.proxyVersion,t.certificateKey=o.certificateKey,t.certificateContent=o.certificateContent,x.value=!0},F=o=>{k.value=!0,ee({configId:o.id}).then(a=>{k.value=!1,a.data&&C()})},z=()=>{t.id=void 0,t.deviceKey="",t.remarks="",t.port=void 0,t.domain=void 0,t.localIp="",t.localPort=void 0,t.connectType="",t.proxyVersion="",t.certificateKey="",t.certificateContent="",x.value=!0},L=()=>{U.value.validate().then(o=>{console.log("添加配置表单",t),te({packageId:R.query.packageId,...t}).then(a=>{C(),x.value=!1})})},G=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"外网端口",dataIndex:"port",key:"port"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(o,a)=>{const f=m("a-button"),H=m("a-table"),D=m("a-select"),v=m("a-form-item"),I=m("a-input"),g=m("a-select-option"),V=m("a-textarea"),O=m("a-form"),Y=m("a-modal");return s(),r("div",null,[n(f,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:z},{default:l(()=>[i("添加穿透")]),_:1}),n(f,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:C},{default:l(()=>[i("刷新列表")]),_:1}),n(H,{loading:k.value,columns:G,rowKey:"id","data-source":h.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:y,onChange:B,scroll:{x:10}},{bodyCell:l(({column:e,record:_})=>[e.key==="deviceKey"?(s(),r(q,{key:0},[c("div",null," 设备状态："+d(w(_.deviceKey)),1),J(Q).getUserInfo().role==="ADMIN"?(s(),r("div",ne,[K(_.deviceKey).username?(s(),r("div",oe," 归属用户： "+d(K(_.deviceKey).username),1)):u("",!0),K(_.deviceKey).userDesc?(s(),r("div",le," 归属用户备注："+d(K(_.deviceKey).userDesc),1)):u("",!0)])):u("",!0)],64)):u("",!0),e.key==="action"?(s(),r(q,{key:1},[n(f,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:E=>A(_)},{default:l(()=>[i("删除 ")]),_:2},1032,["onClick"]),n(f,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:E=>M(_)},{default:l(()=>[i("编辑 ")]),_:2},1032,["onClick"]),n(f,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:E=>F(_)},{default:l(()=>[i("重连配置 ")]),_:2},1032,["onClick"])],64)):u("",!0)]),expandedRowRender:l(({record:e})=>[c("div",ie,[c("div",null,"备注："+d(e.remarks),1),e.connectType==="TCP"?(s(),r("div",se,[e.port?(s(),r("div",re,[i("外网TCP地址: "),c("span",ue,d(e.serverIp)+":"+d(e.port),1)])):u("",!0),e.domain?(s(),r("div",de,[i("外网HTTP地址: "),c("span",ce,"http(s)://"+d(e.domain),1)])):u("",!0)])):u("",!0),e.connectType==="UDP"?(s(),r("div",pe,[e.port?(s(),r("div",fe,[i("外网UDP地址: "),c("span",ve,d(e.serverIp)+":"+d(e.port),1)])):u("",!0)])):u("",!0),e.connectType==="TCP_UDP"?(s(),r("div",me,[e.port?(s(),r("div",ye,[i("外网UDP地址: "),c("span",_e,d(e.serverIp)+":"+d(e.port),1)])):u("",!0),e.port?(s(),r("div",ge,[i("外网TCP地址: "),c("span",ke,d(e.serverIp)+":"+d(e.port),1)])):u("",!0),e.domain?(s(),r("div",Ce,[i("外网HTTP地址: "),c("span",xe,"http(s)://"+d(e.domain),1)])):u("",!0)])):u("",!0),e.statusMsg?(s(),r("div",Ie,[i(" 最近一条穿透服务日志："),c("span",Te,d(e.statusMsg),1)])):u("",!0),e.port?u("",!0):(s(),r("div",Pe," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),c("div",null,[n(Y,{okText:"确定",cancelText:"取消",visible:x.value,"onUpdate:visible":a[10]||(a[10]=e=>x.value=e),title:"添加内网穿透配置",onOk:L},{default:l(()=>[n(O,{model:t,ref_key:"formTable",ref:U},{default:l(()=>[n(v,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:l(()=>[n(D,{value:t.deviceKey,"onUpdate:value":a[0]||(a[0]=e=>t.deviceKey=e),options:b.value},null,8,["value","options"])]),_:1}),n(v,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:l(()=>[n(I,{value:t.remarks,"onUpdate:value":a[1]||(a[1]=e=>t.remarks=e),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),n(v,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:l(()=>[n(D,{value:t.connectType,"onUpdate:value":a[2]||(a[2]=e=>t.connectType=e)},{default:l(()=>[n(g,{value:"TCP"},{default:l(()=>[i("TCP")]),_:1}),n(g,{value:"UDP"},{default:l(()=>[i("UDP")]),_:1}),n(g,{value:"TCP_UDP"},{default:l(()=>[i("TCP_UDP")]),_:1})]),_:1},8,["value"])]),_:1}),n(v,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:l(()=>[n(I,{value:t.port,"onUpdate:value":a[3]||(a[3]=e=>t.port=e),valueModifiers:{number:!0},type:"number",placeholder:"8084"},null,8,["value"])]),_:1}),n(v,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:l(()=>[n(I,{value:t.localIp,"onUpdate:value":a[4]||(a[4]=e=>t.localIp=e),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),n(v,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:l(()=>[n(I,{value:t.localPort,"onUpdate:value":a[5]||(a[5]=e=>t.localPort=e),valueModifiers:{number:!0},type:"number",placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),n(v,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:l(()=>[n(D,{value:t.proxyVersion,"onUpdate:value":a[6]||(a[6]=e=>t.proxyVersion=e)},{default:l(()=>[n(g,{value:"NONE"},{default:l(()=>[i("不设置(小白用户请不要设置-用于获取真实IP)")]),_:1}),n(g,{value:"V1"},{default:l(()=>[i("TCP#V1版本")]),_:1}),n(g,{value:"V2"},{default:l(()=>[i("TCP#V2版本")]),_:1}),n(g,{value:"V3"},{default:l(()=>[i("HTTP#X-Forwarded-For")]),_:1})]),_:1},8,["value"])]),_:1}),n(v,{label:" 穿透域名  ",name:"domain"},{default:l(()=>[n(I,{value:t.domain,"onUpdate:value":a[7]||(a[7]=e=>t.domain=e),placeholder:"xxx.com"},null,8,["value"])]),_:1}),n(v,{label:" 证书KEY  ",name:"certificateKey",rules:[{required:!1,message:"必须填写证书.key文件"}]},{default:l(()=>[n(V,{rows:6,value:t.certificateKey,"onUpdate:value":a[8]||(a[8]=e=>t.certificateKey=e),placeholder:`-----BEGIN RSA PRIVATE KEY-----
***大概是这样的证书私钥***
-----END RSA PRIVATE KEY-----`},null,8,["value"])]),_:1},8,["rules"]),n(v,{label:" 证书内容  ",name:"certificateContent",rules:[{required:!1,message:"映射描述必填"}]},{default:l(()=>[n(V,{rows:6,value:t.certificateContent,"onUpdate:value":a[9]||(a[9]=e=>t.certificateContent=e),placeholder:`-----BEGIN CERTIFICATE-----
***大概是这样的证书内容***
-----BEGIN CERTIFICATE-----`},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{De as default};

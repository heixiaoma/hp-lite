import{s as T}from"./http-e687649d.js";import{r as x,j as J,g as R,h as Q,o as r,c as u,b as o,w as l,a as f,e as m,f as i,F as w,t as p,k as W,i as d}from"./index-5c2911ba.js";import{u as Z}from"./userInfo-b8e9852a.js";import{q as ee}from"./domain-35be8cad.js";function te(v){return T({url:"/client/config/getConfigList",method:"get",params:v})}function ae(v){return T({url:"/client/config/removeConfig",method:"get",params:v})}function ne(v){return T({url:"/client/config/refConfig",method:"get",params:v})}function oe(v){return T({url:"/client/config/addConfig",method:"post",data:v})}function le(v){return T({url:"/client/config/getDeviceKey",method:"get",params:v})}const ie={key:0},se={key:0},re={key:1},ue={class:"text-detail"},de={key:0},pe={key:0},fe={class:"text-tips"},ve={key:1},ce={class:"text-tips"},me={key:1},ye={key:0},ge={class:"text-tips"},_e={key:2},ke={key:0},Ce={class:"text-tips"},xe={key:1},Ie={class:"text-tips"},Te={key:2},be={class:"text-tips"},Pe={key:3},Ke={class:"text-tips"},De={key:4},Ne={__name:"config",setup(v){const U=x([]),B=J(),g=R({total:0,current:1,pageSize:10}),A=n=>{g.current=n.current,g.pageSize=n.pageSize,g.total=n.total,C()},E=x(),I=x(!1),k=x(!1),a=R({id:void 0,deviceKey:"",remarks:"",port:void 0,domain:void 0,localIp:"",localPort:void 0,connectType:"",proxyVersion:"",certificateKey:"",certificateContent:""}),V=x(),b=x(),M=()=>{ee({}).then(n=>{const e=n.data.data;console.log(e),e.forEach(s=>{U.value.push({value:s.domain,label:s.domain,certificateContent:s.certificateContent,certificateKey:s.certificateKey})})})},S=n=>{const e=U.value.filter(s=>s.value===n);console.log(e),e.length===1&&(a.certificateKey=e[0].certificateKey.trim(),a.certificateContent=e[0].certificateContent.trim())},F=()=>{le().then(n=>{let e=[];for(let s of n.data)e.push({label:s.desc,value:s.key,userDesc:s.userDesc,username:s.username});b.value=e})},L=n=>{try{return b.value.filter(e=>e.value===n)[0].label}catch{return"设备获取错误"}},P=n=>{try{return b.value.filter(e=>e.value===n)[0]}catch{return""}},C=()=>{V.value=[],k.value=!0,te(g).then(n=>{k.value=!1,V.value=n.data.records,g.current=n.data.current,g.total=n.data.total}).catch(n=>{k.value=!1})};Q(()=>{F(),M(),C()});const O=n=>{ae({configId:n.id}).then(e=>{e.data&&C()})},z=n=>{a.id=n.id,a.deviceKey=n.deviceKey,a.remarks=n.remarks,a.port=n.port,a.domain=n.domain,a.localIp=n.localIp,a.localPort=n.localPort,a.connectType=n.connectType,a.proxyVersion=n.proxyVersion,a.certificateKey=n.certificateKey,a.certificateContent=n.certificateContent,I.value=!0},G=n=>{k.value=!0,ne({configId:n.id}).then(e=>{k.value=!1,e.data&&C()})},H=()=>{a.id=void 0,a.deviceKey="",a.remarks="",a.port=void 0,a.domain=void 0,a.localIp="",a.localPort=void 0,a.connectType="",a.proxyVersion="",a.certificateKey="",a.certificateContent="",I.value=!0},Y=()=>{E.value.validate().then(n=>{console.log("添加配置表单",a),oe({packageId:B.query.packageId,...a}).then(e=>{C(),I.value=!1})})},$=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"外网端口",dataIndex:"port",key:"port"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(n,e)=>{const s=m("a-button"),h=m("a-table"),K=m("a-select"),c=m("a-form-item"),D=m("a-input"),_=m("a-select-option"),q=m("a-textarea"),j=m("a-form"),X=m("a-modal");return r(),u("div",null,[o(s,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:H},{default:l(()=>e[11]||(e[11]=[i("添加穿透")])),_:1}),o(s,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:C},{default:l(()=>e[12]||(e[12]=[i("刷新列表")])),_:1}),o(h,{loading:k.value,columns:$,rowKey:"id","data-source":V.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:g,onChange:A,scroll:{x:10}},{bodyCell:l(({column:t,record:y})=>[t.key==="deviceKey"?(r(),u(w,{key:0},[f("div",null," 设备状态："+p(L(y.deviceKey)),1),W(Z).getUserInfo().role==="ADMIN"?(r(),u("div",ie,[P(y.deviceKey).username?(r(),u("div",se," 归属用户： "+p(P(y.deviceKey).username),1)):d("",!0),P(y.deviceKey).userDesc?(r(),u("div",re," 归属用户备注："+p(P(y.deviceKey).userDesc),1)):d("",!0)])):d("",!0)],64)):d("",!0),t.key==="action"?(r(),u(w,{key:1},[o(s,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:N=>O(y)},{default:l(()=>e[13]||(e[13]=[i("删除 ")])),_:2},1032,["onClick"]),o(s,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:N=>z(y)},{default:l(()=>e[14]||(e[14]=[i("编辑 ")])),_:2},1032,["onClick"]),o(s,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:N=>G(y)},{default:l(()=>e[15]||(e[15]=[i("重连配置 ")])),_:2},1032,["onClick"])],64)):d("",!0)]),expandedRowRender:l(({record:t})=>[f("div",ue,[f("div",null,"备注："+p(t.remarks),1),t.connectType==="TCP"?(r(),u("div",de,[t.port?(r(),u("div",pe,[e[16]||(e[16]=i("外网TCP地址: ")),f("span",fe,p(t.serverIp)+":"+p(t.port),1)])):d("",!0),t.domain?(r(),u("div",ve,[e[17]||(e[17]=i("外网HTTP地址: ")),f("span",ce,"http(s)://"+p(t.domain),1)])):d("",!0)])):d("",!0),t.connectType==="UDP"?(r(),u("div",me,[t.port?(r(),u("div",ye,[e[18]||(e[18]=i("外网UDP地址: ")),f("span",ge,p(t.serverIp)+":"+p(t.port),1)])):d("",!0)])):d("",!0),t.connectType==="TCP_UDP"?(r(),u("div",_e,[t.port?(r(),u("div",ke,[e[19]||(e[19]=i("外网UDP地址: ")),f("span",Ce,p(t.serverIp)+":"+p(t.port),1)])):d("",!0),t.port?(r(),u("div",xe,[e[20]||(e[20]=i("外网TCP地址: ")),f("span",Ie,p(t.serverIp)+":"+p(t.port),1)])):d("",!0),t.domain?(r(),u("div",Te,[e[21]||(e[21]=i("外网HTTP地址: ")),f("span",be,"http(s)://"+p(t.domain),1)])):d("",!0)])):d("",!0),t.statusMsg?(r(),u("div",Pe,[e[22]||(e[22]=i(" 最近一条穿透服务日志：")),f("span",Ke,p(t.statusMsg),1)])):d("",!0),t.port?d("",!0):(r(),u("div",De," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),f("div",null,[o(X,{okText:"确定",cancelText:"取消",visible:I.value,"onUpdate:visible":e[10]||(e[10]=t=>I.value=t),title:"添加内网穿透配置",onOk:Y},{default:l(()=>[o(j,{model:a,ref_key:"formTable",ref:E},{default:l(()=>[o(c,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:l(()=>[o(K,{value:a.deviceKey,"onUpdate:value":e[0]||(e[0]=t=>a.deviceKey=t),options:b.value},null,8,["value","options"])]),_:1}),o(c,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:l(()=>[o(D,{value:a.remarks,"onUpdate:value":e[1]||(e[1]=t=>a.remarks=t),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),o(c,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:l(()=>[o(K,{value:a.connectType,"onUpdate:value":e[2]||(e[2]=t=>a.connectType=t)},{default:l(()=>[o(_,{value:"TCP"},{default:l(()=>e[23]||(e[23]=[i("TCP")])),_:1}),o(_,{value:"UDP"},{default:l(()=>e[24]||(e[24]=[i("UDP")])),_:1}),o(_,{value:"TCP_UDP"},{default:l(()=>e[25]||(e[25]=[i("TCP_UDP")])),_:1})]),_:1},8,["value"])]),_:1}),o(c,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:l(()=>[o(D,{value:a.port,"onUpdate:value":e[3]||(e[3]=t=>a.port=t),valueModifiers:{number:!0},type:"number",placeholder:"8084"},null,8,["value"])]),_:1}),o(c,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:l(()=>[o(D,{value:a.localIp,"onUpdate:value":e[4]||(e[4]=t=>a.localIp=t),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),o(c,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:l(()=>[o(D,{value:a.localPort,"onUpdate:value":e[5]||(e[5]=t=>a.localPort=t),valueModifiers:{number:!0},type:"number",placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),o(c,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:l(()=>[o(K,{value:a.proxyVersion,"onUpdate:value":e[6]||(e[6]=t=>a.proxyVersion=t)},{default:l(()=>[o(_,{value:"NONE"},{default:l(()=>e[26]||(e[26]=[i("不设置(小白用户请不要设置-用于获取真实IP)")])),_:1}),o(_,{value:"V1"},{default:l(()=>e[27]||(e[27]=[i("TCP#V1版本")])),_:1}),o(_,{value:"V2"},{default:l(()=>e[28]||(e[28]=[i("TCP#V2版本")])),_:1}),o(_,{value:"V3"},{default:l(()=>e[29]||(e[29]=[i("HTTP#X-Forwarded-For")])),_:1})]),_:1},8,["value"])]),_:1}),o(c,{label:" 穿透域名  ",name:"domain"},{default:l(()=>[o(K,{value:a.domain,"onUpdate:value":e[7]||(e[7]=t=>a.domain=t),"show-search":"",placeholder:"选择一个域名",options:U.value,onChange:S},null,8,["value","options"])]),_:1}),o(c,{label:" 证书KEY  ",name:"certificateKey",rules:[{required:!1,message:"必须填写证书.key文件"}]},{default:l(()=>[o(q,{disabled:"disabled",rows:6,value:a.certificateKey,"onUpdate:value":e[8]||(e[8]=t=>a.certificateKey=t),placeholder:`-----BEGIN RSA PRIVATE KEY-----
***大概是这样的证书私钥***
-----END RSA PRIVATE KEY-----`},null,8,["value"])]),_:1}),o(c,{label:" 证书内容  ",name:"certificateContent",rules:[{required:!1,message:"映射描述必填"}]},{default:l(()=>[o(q,{disabled:"disabled",rows:6,value:a.certificateContent,"onUpdate:value":e[9]||(e[9]=t=>a.certificateContent=t),placeholder:`-----BEGIN CERTIFICATE-----
***大概是这样的证书内容***
-----BEGIN CERTIFICATE-----`},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{Ne as default};

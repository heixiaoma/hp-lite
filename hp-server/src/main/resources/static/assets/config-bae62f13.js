import{s as P}from"./http-f9a7bed9.js";import{d as a,A,k as E,u as F,r as b,h as H,i as G,a as g,o as d,c as p,b as u,l as O,w as o,f as i,F as J,j as m,t as c}from"./index-1cd037b6.js";import"./userInfo-b8e9852a.js";var Q={icon:function(s,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm104 240.9c0 10.3-4.9 19.9-13.2 25.9L457.4 512l145.4 105.1c8.3 6 13.2 15.7 13.2 25.9v46.9c0 6.5-7.4 10.3-12.7 6.5l-246-178a7.95 7.95 0 010-12.9l246-178c5.3-3.8 12.7 0 12.7 6.5v46.9z",fill:r}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:s}},{tag:"path",attrs:{d:"M603.3 327.5l-246 178a7.95 7.95 0 000 12.9l246 178c5.3 3.8 12.7 0 12.7-6.5V643c0-10.2-4.9-19.9-13.2-25.9L457.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5z",fill:s}}]}},name:"left-circle",theme:"twotone"};const W=Q;function q(n){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?Object(arguments[s]):{},_=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(r).filter(function(v){return Object.getOwnPropertyDescriptor(r,v).enumerable}))),_.forEach(function(v){X(n,v,r[v])})}return n}function X(n,s,r){return s in n?Object.defineProperty(n,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[s]=r,n}var U=function(s,r){var _=q({},s,r.attrs);return a(A,q({},_,{icon:W}),null)};U.displayName="LeftCircleTwoTone";U.inheritAttrs=!1;const Y=U;function Z(n){return P({url:"/client/config/getConfigList",method:"get",params:n})}function ee(n){return P({url:"/client/config/removeConfig",method:"get",params:n})}function te(n){return P({url:"/client/config/refConfig",method:"get",params:n})}function ae(n){return P({url:"/client/config/addConfig",method:"post",data:n})}function ne(n){return P({url:"/client/config/getDeviceKey",method:"get",params:n})}const oe={style:{display:"flex","justify-content":"flex-end"}},le={class:"text-detail"},se={key:0},ie={key:0},re={class:"text-tips"},ue={class:"text-tips"},ce={key:1},de={key:0},pe={class:"text-tips"},fe={key:2},me={key:0},ve={class:"text-tips"},_e={key:1},ge={class:"text-tips"},ye={class:"text-tips"},ke={key:3},Ce={class:"text-tips"},Te={key:4},he={__name:"config",setup(n){const s=E(),r=F(),_=b(),v=b(!1),C=b(!1),l=H({deviceKey:"",remarks:"",port:"",domain:"",localIp:"",localPort:"",connectType:""}),h=b(),D=b(),K=()=>{ne().then(f=>{let t=[];for(let y of f.data)t.push({label:y.desc,value:y.key});D.value=t})},T=()=>{h.value=[],C.value=!0,console.log(s.query),Z().then(f=>{C.value=!1,h.value=f.data}).catch(f=>{C.value=!1})};G(()=>{K(),T()});const M=f=>{ee({configId:f.id}).then(t=>{t.data&&T()})},S=f=>{C.value=!0,te({configId:f.id}).then(t=>{C.value=!1,t.data&&T()})},V=()=>{v.value=!0},j=()=>{_.value.validate().then(f=>{console.log("添加配置表单",l),ae({packageId:s.query.packageId,...l}).then(t=>{T(),v.value=!1})})},z=[{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"操作",key:"action"}];return(f,t)=>{const y=g("a-button"),N=g("a-table"),w=g("a-select"),k=g("a-form-item"),x=g("a-input"),I=g("a-select-option"),$=g("a-form"),B=g("a-modal");return d(),p("div",null,[u("div",oe,[a(O(Y),{style:{"font-size":"30px"},onClick:t[0]||(t[0]=e=>O(r).push({name:"package"}))})]),a(y,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:V},{default:o(()=>[i("添加穿透")]),_:1}),a(y,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:T},{default:o(()=>[i("刷新列表")]),_:1}),a(N,{loading:C.value,columns:z,rowKey:"id","data-source":h.value,locale:{emptyText:"暂无配置,添加一个试试看看"},scroll:{x:10},pagination:!1},{bodyCell:o(({column:e,record:L})=>[e.key==="action"?(d(),p(J,{key:0},[a(y,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:R=>M(L)},{default:o(()=>[i("删除")]),_:2},1032,["onClick"]),a(y,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:R=>S(L)},{default:o(()=>[i("重连配置")]),_:2},1032,["onClick"])],64)):m("",!0)]),expandedRowRender:o(({record:e})=>[u("div",le,[u("div",null,"备注："+c(e.remarks),1),e.connectType==="TCP"?(d(),p("div",se,[e.port?(d(),p("div",ie,[i("外网TCP地址: "),u("span",re,c(e.serverIp)+":"+c(e.port),1)])):m("",!0),u("div",null,[i("外网HTTP地址: "),u("span",ue,"http(s)://"+c(e.domain),1)])])):m("",!0),e.connectType==="UDP"?(d(),p("div",ce,[e.port?(d(),p("div",de,[i("外网UDP地址: "),u("span",pe,c(e.serverIp)+":"+c(e.port),1)])):m("",!0)])):m("",!0),e.connectType==="TCP_UDP"?(d(),p("div",fe,[e.port?(d(),p("div",me,[i("外网UDP地址: "),u("span",ve,c(e.serverIp)+":"+c(e.port),1)])):m("",!0),e.port?(d(),p("div",_e,[i("外网TCP地址: "),u("span",ge,c(e.serverIp)+":"+c(e.port),1)])):m("",!0),u("div",null,[i("外网HTTP地址: "),u("span",ye,"http(s)://"+c(e.domain),1)])])):m("",!0),e.statusMsg?(d(),p("div",ke,[i(" 最近一条穿透服务日志："),u("span",Ce,c(e.statusMsg),1)])):m("",!0),e.port?m("",!0):(d(),p("div",Te," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source"]),u("div",null,[a(B,{okText:"确定",cancelText:"取消",visible:v.value,"onUpdate:visible":t[8]||(t[8]=e=>v.value=e),title:"添加内网穿透配置",onOk:j},{default:o(()=>[a($,{model:l,ref_key:"formTable",ref:_},{default:o(()=>[a(k,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:o(()=>[a(w,{value:l.deviceKey,"onUpdate:value":t[1]||(t[1]=e=>l.deviceKey=e),options:D.value},null,8,["value","options"])]),_:1}),a(k,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:o(()=>[a(x,{value:l.remarks,"onUpdate:value":t[2]||(t[2]=e=>l.remarks=e),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),a(k,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:o(()=>[a(w,{value:l.connectType,"onUpdate:value":t[3]||(t[3]=e=>l.connectType=e)},{default:o(()=>[a(I,{value:"TCP"},{default:o(()=>[i("TCP")]),_:1}),a(I,{value:"UDP"},{default:o(()=>[i("UDP")]),_:1}),a(I,{value:"TCP_UDP"},{default:o(()=>[i("TCP_UDP")]),_:1})]),_:1},8,["value"])]),_:1}),a(k,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:o(()=>[a(x,{value:l.port,"onUpdate:value":t[4]||(t[4]=e=>l.port=e),placeholder:"8084"},null,8,["value"])]),_:1}),a(k,{label:"穿透域名",name:"domain",rules:[{required:!0,message:"穿透域名必填"}]},{default:o(()=>[a(x,{value:l.domain,"onUpdate:value":t[5]||(t[5]=e=>l.domain=e),placeholder:"xxx.com"},null,8,["value"])]),_:1}),a(k,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:o(()=>[a(x,{value:l.localIp,"onUpdate:value":t[6]||(t[6]=e=>l.localIp=e),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),a(k,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:o(()=>[a(x,{value:l.localPort,"onUpdate:value":t[7]||(t[7]=e=>l.localPort=e),placeholder:"内网端口如：8080"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{he as default};

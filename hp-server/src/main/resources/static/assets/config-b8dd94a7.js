import{s as T}from"./http-edf89e88.js";import{k as Y,u as $,h as E,r as I,i as H,o as r,c as u,b as a,w as l,a as d,e as v,f as i,t as s,j as c,F as j}from"./index-40665d3d.js";import"./userInfo-b8e9852a.js";function J(p){return T({url:"/client/config/getConfigList",method:"get",params:p})}function Q(p){return T({url:"/client/config/removeConfig",method:"get",params:p})}function W(p){return T({url:"/client/config/refConfig",method:"get",params:p})}function X(p){return T({url:"/client/config/addConfig",method:"post",data:p})}function Z(p){return T({url:"/client/config/getDeviceKey",method:"get",params:p})}const ee={key:0},te={class:"text-detail"},ae={key:0},oe={key:0},ne={class:"text-tips"},le={class:"text-tips"},ie={key:1},se={key:0},re={class:"text-tips"},ue={key:2},de={key:0},ce={class:"text-tips"},pe={key:1},fe={class:"text-tips"},ve={class:"text-tips"},me={key:3},ye={class:"text-tips"},_e={key:4},xe={__name:"config",setup(p){const N=Y();$();const m=E({total:0,current:1,pageSize:10}),q=n=>{m.current=n.current,m.pageSize=n.pageSize,m.total=n.total,g()},U=I(),C=I(!1),_=I(!1),t=E({id:"",deviceKey:"",remarks:"",port:"",domain:void 0,localIp:"",localPort:"",connectType:"",proxyVersion:"",certificateKey:"",certificateContent:""}),b=I(),K=I(),R=()=>{Z().then(n=>{let o=[];for(let y of n.data)o.push({label:y.desc,value:y.key});K.value=o})},S=n=>{try{return K.value.filter(o=>o.value===n)[0].label}catch{return"设备获取错误"}},g=()=>{b.value=[],_.value=!0,J(m).then(n=>{_.value=!1,b.value=n.data.records,m.current=n.data.current,m.pageSize=n.data.size,m.total=n.data.total}).catch(n=>{_.value=!1})};H(()=>{R(),g()});const B=n=>{Q({configId:n.id}).then(o=>{o.data&&g()})},w=n=>{t.id=n.id,t.deviceKey=n.deviceKey,t.remarks=n.remarks,t.port=n.port,t.domain=n.domain,t.localIp=n.localIp,t.localPort=n.localPort,t.connectType=n.connectType,t.proxyVersion=n.proxyVersion,t.certificateKey=n.certificateKey,t.certificateContent=n.certificateContent,C.value=!0},A=n=>{_.value=!0,W({configId:n.id}).then(o=>{_.value=!1,o.data&&g()})},z=()=>{t.id="",t.deviceKey="",t.remarks="",t.port="",t.domain=void 0,t.localIp="",t.localPort="",t.connectType="",t.proxyVersion="",t.certificateKey="",t.certificateContent="",C.value=!0},L=()=>{U.value.validate().then(n=>{console.log("添加配置表单",t),X({packageId:N.query.packageId,...t}).then(o=>{g(),C.value=!1})})},F=[{title:"配置ID",dataIndex:"id",key:"id"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"内网IP",dataIndex:"localIp",key:"localIp"},{title:"内网端口",dataIndex:"localPort",key:"localPort"},{title:"外网端口",dataIndex:"port",key:"port"},{title:"穿透类型",dataIndex:"connectType",key:"connectType"},{title:"域名",dataIndex:"domain",key:"domain"},{title:"部署设备",dataIndex:"deviceKey",key:"deviceKey"},{title:"操作",key:"action"}];return(n,o)=>{const y=v("a-button"),M=v("a-table"),h=v("a-select"),f=v("a-form-item"),x=v("a-input"),k=v("a-select-option"),D=v("a-textarea"),G=v("a-form"),O=v("a-modal");return r(),u("div",null,[a(y,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:z},{default:l(()=>[i("添加穿透")]),_:1}),a(y,{type:"primary",style:{"margin-bottom":"10px","margin-left":"10px"},onClick:g},{default:l(()=>[i("刷新列表")]),_:1}),a(M,{loading:_.value,columns:F,rowKey:"id","data-source":b.value,locale:{emptyText:"暂无配置,添加一个试试看看"},pagination:m,onChange:q,scroll:{x:10}},{bodyCell:l(({column:e,record:P})=>[e.key==="deviceKey"?(r(),u("div",ee,s(S(P.deviceKey)),1)):c("",!0),e.key==="action"?(r(),u(j,{key:1},[a(y,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>B(P)},{default:l(()=>[i("删除 ")]),_:2},1032,["onClick"]),a(y,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>w(P)},{default:l(()=>[i("编辑 ")]),_:2},1032,["onClick"]),a(y,{type:"primary",style:{"margin-bottom":"5px","margin-left":"5px"},onClick:V=>A(P)},{default:l(()=>[i("重连配置 ")]),_:2},1032,["onClick"])],64)):c("",!0)]),expandedRowRender:l(({record:e})=>[d("div",te,[d("div",null,"备注："+s(e.remarks),1),e.connectType==="TCP"?(r(),u("div",ae,[e.port?(r(),u("div",oe,[i("外网TCP地址: "),d("span",ne,s(e.serverIp)+":"+s(e.port),1)])):c("",!0),d("div",null,[i("外网HTTP地址: "),d("span",le,"http(s)://"+s(e.domain),1)])])):c("",!0),e.connectType==="UDP"?(r(),u("div",ie,[e.port?(r(),u("div",se,[i("外网UDP地址: "),d("span",re,s(e.serverIp)+":"+s(e.port),1)])):c("",!0)])):c("",!0),e.connectType==="TCP_UDP"?(r(),u("div",ue,[e.port?(r(),u("div",de,[i("外网UDP地址: "),d("span",ce,s(e.serverIp)+":"+s(e.port),1)])):c("",!0),e.port?(r(),u("div",pe,[i("外网TCP地址: "),d("span",fe,s(e.serverIp)+":"+s(e.port),1)])):c("",!0),d("div",null,[i("外网HTTP地址: "),d("span",ve,"http(s)://"+s(e.domain),1)])])):c("",!0),e.statusMsg?(r(),u("div",me,[i(" 最近一条穿透服务日志："),d("span",ye,s(e.statusMsg),1)])):c("",!0),e.port?c("",!0):(r(),u("div",_e," 随机端口不支持TCP和UDP协议使用 "))])]),_:1},8,["loading","data-source","pagination"]),d("div",null,[a(O,{okText:"确定",cancelText:"取消",visible:C.value,"onUpdate:visible":o[10]||(o[10]=e=>C.value=e),title:"添加内网穿透配置",onOk:L},{default:l(()=>[a(G,{model:t,ref_key:"formTable",ref:U},{default:l(()=>[a(f,{label:"穿透设备",name:"deviceKey",rules:[{required:!0,message:"穿透设备必填"}]},{default:l(()=>[a(h,{value:t.deviceKey,"onUpdate:value":o[0]||(o[0]=e=>t.deviceKey=e),options:K.value},null,8,["value","options"])]),_:1}),a(f,{label:"穿透备注",name:"remarks",rules:[{required:!0,message:"穿透备注必填"}]},{default:l(()=>[a(x,{value:t.remarks,"onUpdate:value":o[1]||(o[1]=e=>t.remarks=e),placeholder:"备注如：个人博客"},null,8,["value"])]),_:1}),a(f,{label:"穿透协议",name:"connectType",rules:[{required:!0,message:"穿透协议必填"}]},{default:l(()=>[a(h,{value:t.connectType,"onUpdate:value":o[2]||(o[2]=e=>t.connectType=e)},{default:l(()=>[a(k,{value:"TCP"},{default:l(()=>[i("TCP")]),_:1}),a(k,{value:"UDP"},{default:l(()=>[i("UDP")]),_:1}),a(k,{value:"TCP_UDP"},{default:l(()=>[i("TCP_UDP")]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:"外网端口",name:"port",rules:[{required:!0,message:"外网端口必填"}]},{default:l(()=>[a(x,{value:t.port,"onUpdate:value":o[3]||(o[3]=e=>t.port=e),placeholder:"8084"},null,8,["value"])]),_:1}),a(f,{label:"内网地址",name:"localIp",rules:[{required:!0,message:"内网地址必填"}]},{default:l(()=>[a(x,{value:t.localIp,"onUpdate:value":o[4]||(o[4]=e=>t.localIp=e),placeholder:"内网IP如：127.0.0.1"},null,8,["value"])]),_:1}),a(f,{label:"内网端口",name:"localPort",rules:[{required:!0,message:"内网端口必填"}]},{default:l(()=>[a(x,{value:t.localPort,"onUpdate:value":o[5]||(o[5]=e=>t.localPort=e),placeholder:"内网端口如：8080"},null,8,["value"])]),_:1}),a(f,{label:"代理协议",name:"proxyVersion",rules:[{required:!0,message:"用于获取真实IP，需要内网配合完成"}]},{default:l(()=>[a(h,{value:t.proxyVersion,"onUpdate:value":o[6]||(o[6]=e=>t.proxyVersion=e)},{default:l(()=>[a(k,{value:"NONE"},{default:l(()=>[i("不设置(小白用户请不要设置-用于获取真实IP)")]),_:1}),a(k,{value:"V1"},{default:l(()=>[i("V1版本")]),_:1}),a(k,{value:"V2"},{default:l(()=>[i("V2版本")]),_:1})]),_:1},8,["value"])]),_:1}),a(f,{label:" 穿透域名  ",name:"domain"},{default:l(()=>[a(x,{value:t.domain,"onUpdate:value":o[7]||(o[7]=e=>t.domain=e),placeholder:"xxx.com"},null,8,["value"])]),_:1}),a(f,{label:" 证书KEY  ",name:"certificateKey",rules:[{required:!1,message:"必须填写证书.key文件"}]},{default:l(()=>[a(D,{rows:6,value:t.certificateKey,"onUpdate:value":o[8]||(o[8]=e=>t.certificateKey=e),placeholder:`-----BEGIN RSA PRIVATE KEY-----
***大概是这样的证书私钥***
-----END RSA PRIVATE KEY-----`},null,8,["value"])]),_:1}),a(f,{label:" 证书内容  ",name:"certificateContent",rules:[{required:!1,message:"映射描述必填"}]},{default:l(()=>[a(D,{rows:6,value:t.certificateContent,"onUpdate:value":o[9]||(o[9]=e=>t.certificateContent=e),placeholder:`-----BEGIN CERTIFICATE-----
***大概是这样的证书内容***
-----BEGIN CERTIFICATE-----`},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])])}}};export{xe as default};

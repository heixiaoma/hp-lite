# HP-Lite 服务端介绍

HP-Lite 服务端是整个内网穿透系统的 “中枢核心”，负责接收外网访问请求、与内网客户端建立稳定连接、转发流量至目标内网应用，同时通过配置文件实现后台管理、端口监听、证书申请等核心功能的自定义配置。只有完成服务端部署与配置文件调试后，内网客户端才能通过其实现 “外网访问内网资源” 的核心需求。

## 一、服务端核心定位与作用

服务端作为连接 “外网” 与 “内网” 的桥梁，承担四大关键角色，所有功能可通过配置文件灵活调整：



1. **连接中枢**：通过配置文件中 `cmd` 模块指定的控制端口，用于控制客户端的配置，刷新 ，停止，资源监控等操作；

2. **请求转发**：基于 `tunnel` 模块配置的隧道 IP 与端口，解析外网用户通过域名发起的访问请求，按预设规则转发至对应内网客户端；

3. **管理入口**：通过 `admin` 模块配置的后台账号、密码与端口，提供 Web 管理后台，支持管理员配置穿透规则、查看设备状态；

4. **安全与证书管理**：借助 `acme` 模块配置的邮箱与验证端口，自动申请 SSL 证书，同时支持通过配置调整域名转发、端口监听等安全相关功能。

## 二、服务端系统架构与环境要求

### 1. 系统架构支持（官方提供版本）

HP-Lite 服务端提供多架构二进制文件，可直接匹配不同服务器硬件，无需额外编译：



| 文件名                    | 适配架构        | 适用操作系统                           |
| ---------------------- | ----------- |----------------------------------|
| `hp-lite-server.exe`   | X86/X86\_64 | Windows Server 2016+/Windows 10+ |
| `hp-lite-server-amd64` | AMD64       | Linux X86                        |
| `hp-lite-server-arm64` | ARM64       | Linux（ARM 架构服务器 / 开发板）、部分 NAS 设备 |

### 2. 硬件配置建议

服务端对硬件要求较低，可根据客户端数量灵活选择，核心需满足 “公网 IP + 端口开放”：



| 访问规模               | CPU             | 内存     | 硬盘          | 网络要求                     |
| ------------------ | --------------- | ------ | ----------- | ------------------------ |
| 个人 / 小团队（≤10 个客户端） | 1 核（X86/ARM 均可） | ≥512MB | ≥100MB 空闲空间 | 公网 IP（静态优先），带宽≥1Mbps     |
| 中小企业（10-50 个客户端）   | 2 核 4 线程        | ≥1GB   | ≥500MB 空闲空间 | 静态公网 IP，带宽≥5Mbps         |
| 大规模部署（＞50 个客户端）    | 4 核 8 线程及以上     | ≥2GB   | ≥1GB 空闲空间   | 静态公网 IP + 负载均衡，带宽≥10Mbps |

### 3. 网络必备条件（重点！影响部署成败）



* **公网 IP**：服务端必须具备公网 IP，需在 `tunnel.ip` 配置中填写此 IP 或对应的解析域名；

* **端口开放**：需开放配置文件中指定的所有端口，且同时开放 **TCP+UDP 权限**（隧道端口支持双协议），具体端口清单如下：



| 端口来源          | 配置文件对应项          | 端口用途                           | 协议类型    | 是否需暴露外网      |
| ------------- | ---------------- | ------------------------------ | ------- | ------------ |
| admin 模块      | `admin.port`     | 管理后台访问端口                       | TCP     | 可选（建议仅内网访问）  |
| cmd 模块        | `cmd.port`       | 客户端与服务端控制连接端口                  | TCP     | 是            |
| tunnel 模块     | `tunnel.port`    | 隧道数据传输端口（核心）                   | TCP+UDP | 是            |
| acme 模块       | `acme.http-port` | SSL 证书验证端口（内部转发）               | TCP     | 否（由 80 端口转发） |
| tunnel 模块（可选） | 80/443           | 域名转发端口（开启`open-domain: true`时） | TCP+UDP | 是            |

> **部署建议**
>
> ：初期部署时，建议暂时关闭服务器防火墙（如 Linux 的 firewalld/ufw、Windows 防火墙）及云厂商安全组，待服务验证正常后，再按需开放上述端口，避免端口拦截导致部署失败。

## 三、核心配置文件解析（app.yml）

`app.yml` 是服务端的核心配置文件，所有功能均通过此文件配置，需根据实际环境修改关键参数，以下是完整配置与详细说明：

### 1. 完整配置文件示例



``` yaml
admin:
  username: 'admin' #后台账号
  password: '123456' #后台密码
  port: 9090 #管理后台监听的端口（HTTP协议传输方式）

cmd:
  port: 16666 #控制指令端口，所有HP-lite 客户端需要连接这个端口（TCP传输方式）

tunnel:
  ip: '127.0.0.1' #隧道监听服务器外网的IP（记得改成你的服务器IP或者解析的域名也可以）
  port: 9091 #隧道传输数据端口，在5.0以后这个端口支持TCP和QUIC(UDP协议) 所以在开放端口时要给TCP和UDP权限
  open-domain: true #true 开启80，443端口域名转发（如果你的服务有宝塔或者nginx等，端口多半是被用了），false 关闭
acme:
  email: '232323@qq.com' #申请证书必须写一个邮箱可以随便写
  http-port: '5634' #证书验证会访问http接口，会通过80转发过来，所以这个端口不用暴露外网
```

### 2. 关键配置修改说明（部署必看）



| 配置项                      | 修改必要性 | 注意事项                                                            |
| ------------------------ | ----- | --------------------------------------------------------------- |
| `admin.username`         | 建议修改  | 避免使用默认 “admin” 账号，降低被暴力破解风险                                     |
| `admin.password`         | 建议修改  | 默认 “123456” 安全性极低，建议设置为 “字母 + 数字 + 特殊符号” 组合（如 HpLite@2025）      |
| `tunnel.ip`              | `必须修改`  | 不可保留 “127.0.0.1”（本地回环地址），需填写服务器外网 IP 或已完成解析的域名，否则客户端无法连接        |
| `tunnel.open-domain`     | 按需修改  | 若服务器已安装宝塔、Nginx 等服务（会占用 80/443 端口），需设为 false，避免端口冲突；无占用则设为 true |
| `tunnel.port`/`cmd.port` | 按需修改  | 若端口被占用（如执行启动命令时提示 “port in use”），需修改为未占用的端口（如 16667、9092）       |

## 四、服务端核心功能模块（与配置文件关联）

服务端所有功能均基于配置文件实现，核心模块与配置的对应关系如下，便于理解配置作用：

### 1. 管理后台模块（对应 `admin` 配置）



* 功能：提供 Web 可视化管理界面，通过 `admin.port` 端口访问（如 `http://服务器IP:9090`）；

* 核心能力：登录后可管理客户端设备（查看在线状态、禁用设备）、配置穿透规则（TCP/UDP/HTTP/HTTPS）、查看流量统计，所有操作实时生效。

### 2. 客户端连接模块（对应 `cmd` 配置）



* 功能：通过 `cmd.port` 端口接收客户端的注册请求，建立控制连接；

* 核心能力：维持客户端在线状态（定时心跳检测）、下发穿透规则配置、同步客户端状态至管理后台。

### 3. 隧道传输模块（对应 `tunnel` 配置）



* 功能：基于 `tunnel.ip` 和 `tunnel.port` 构建数据传输隧道，转发外网与内网间的流量；

* 核心能力：支持 TCP（适用于 Web 服务、SSH 等）和 QUIC（UDP 协议，适用于低延迟场景如视频流），开启 `open-domain: true` 后可直接通过域名访问内网应用（如 `http://app.hp-lite.com`）。

### 4. SSL 证书模块（对应 `acme` 配置）



* 功能：通过 ACME 协议自动申请、部署、续期 Let's Encrypt 免费 SSL 证书；

* 核心能力：开启后穿透规则可配置 HTTPS 访问，保障数据传输安全，证书到期前会自动续期，无需手动操作（依赖 `acme.email` 接收提醒）。

## 五、服务端部署前准备清单

结合配置文件与环境要求，部署前需完成以下准备，确保一次部署成功：



1. **服务器与系统**：选择符合架构的服务器（如 AMD64 架构选 Linux 系统），安装对应版本的操作系统（参考 “系统架构支持”）；

2. **公网 IP 与域名**：确认服务器已获取公网 IP，若需使用域名，需提前将域名 A 记录解析至公网 IP（如将 `server.hp-lite.com` 解析到 `xxx.xxx.xxx.xxx`）；

3. **配置文件准备**：下载官方 `app.yml` 配置文件，按 “关键配置修改说明” 完成自定义修改（尤其是 `tunnel.ip` 和 `admin.password`）；

4. **端口与防火墙**：提前开放配置文件中指定的端口（TCP+UDP），或暂时关闭防火墙 / 安全组（部署验证后再按需配置）；

5. **二进制文件下载**：根据服务器架构下载对应的服务端二进制文件（如 ARM64 架构下载 `hp-lite-server-arm64`），并赋予执行权限（Linux 系统：`chmod +x 文件名`）。

## 六、服务端部署方式说明

HP-Lite 服务端支持三种部署方式，均需基于修改后的 `app.yml` 配置文件，后续文档将详细介绍每种方式的操作步骤：



1. **二进制部署**：直接使用下载的二进制文件 + 修改后的 `app.yml`，通过命令行启动服务（如 Linux：`./hp-lite-server-amd64`），适合熟悉命令行的用户，部署速度快；

2. **Docker 部署**：通过 Docker 镜像加载预设环境，只需挂载自定义 `app.yml` 配置文件即可启动（无需担心依赖冲突），适合追求环境一致性的用户；

> **部署建议**


* 生产环境优先选择 **Docker 部署**（环境隔离，便于升级）或 **二进制部署**（性能损耗低）；

* 无论哪种方式，启动服务前务必确认 `app.yml` 中 `tunnel.ip` 已修改为服务器外网 IP / 域名，否则客户端无法连接。
